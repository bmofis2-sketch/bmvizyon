<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Deprem Demo – Sallanma ve Eşyalar</title>
  <style>
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0f172a;color:#e5e7eb}
    header{padding:18px 22px;border-bottom:1px solid #1f2937;background:#0b1222}
    header h1{margin:0;font-size:20px}
    header p{margin:6px 0 0;color:#9ca3af;font-size:13px}
    .wrap{display:grid;grid-template-columns: 340px 1fr;gap:16px;padding:16px}
    .panel{background:#111827;border:1px solid #1f2937;border-radius:10px;padding:14px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.blue{background:#22d3ee}
    .dot.pink{background:#fb7185}
    canvas{width:100%;height:520px;background:#0a0f1c;border:1px solid #1f2937;border-radius:10px}
  </style>
</head>
<body>
<header>
  <h1>İzolatörlü vs İzolatörsüz Bina – Sallanma Demo</h1>
  <p>Şiddet (M 3–9), Elazığ spektrum senaryoları, gerçekçi yatay salınım ve iç eşyalar.</p>
</header>

<div id="app"></div>

<!-- React ve Babel -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">

function App(){
  const canvasRef = React.useRef(null);
  const [running,setRunning] = React.useState(false);
  const [mag,setMag] = React.useState(6);
  const [spec,setSpec] = React.useState("elazig_mid");

  React.useEffect(()=>{
    const canvas = canvasRef.current;
    const ctx = canvas.getContext("2d");
    let t=0;
    let raf;

    // Sistem parametreleri
    const iso={m:1,k:10,c:4.0,x:0,v:0,color:"#22d3ee"}; // daha fazla sönüm
    const fix={m:1,k:60,c:1.5,x:0,v:0,color:"#fb7185"};
    const dt=1/60;

    function magToAmp(M){return 0.01+(M-3)*(0.1-0.01)/(9-3);} // max 0.1 m

    function groundMotion(t,A){
      if(spec==="elazig_short"){
        return A*(0.6*Math.sin(2*Math.PI*2.5*t)+0.4*Math.sin(2*Math.PI*5*t));
      }else if(spec==="elazig_mid"){
        return A*(0.7*Math.sin(2*Math.PI*1*t)+0.3*Math.sin(2*Math.PI*2*t));
      }else{
        return A*(0.4*Math.sin(2*Math.PI*1*t)+0.35*Math.sin(2*Math.PI*3*t)+0.25*Math.sin(2*Math.PI*5*t));
      }
    }

    function step(sys,ug){
      const a=(-sys.c*sys.v - sys.k*(sys.x-ug))/sys.m;
      sys.v+=a*dt;
      sys.x+=sys.v*dt;
      return a;
    }

    function drawScene(ug,aIso,aFix){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // İzolatörlü bina (mavi) → yatay salınım
      const isoX = 100 + iso.x*30; // küçük ölçek
      ctx.fillStyle="#22d3ee";
      ctx.fillRect(isoX,200,50,200);

      // İç eşyalar (mavi bina) – stabil
      ctx.fillStyle="#0f172a";
      ctx.fillRect(isoX+10,220,20,10); // masa
      ctx.fillRect(isoX+15,260,15,20); // dolap
      ctx.beginPath();
      ctx.arc(isoX+25,310,5,0,Math.PI*2); // sandalye
      ctx.fill();

      // İzolatörsüz bina (pembe) → yatay salınım
      const fixX = 300 + fix.x*30;
      ctx.fillStyle="#fb7185";
      ctx.fillRect(fixX,200,50,200);

      // İç eşyalar (pembe bina) – kayma ve devrilme
      ctx.save();
      ctx.translate(fixX+20 + fix.x*10, 220); // masa kayıyor
      ctx.rotate(fix.x*0.2); // biraz devrilme
      ctx.fillStyle="#0f172a";
      ctx.fillRect(-10,0,20,10);
      ctx.restore();

      ctx.save();
      ctx.translate(fixX+25 + fix.x*15, 260); // dolap kayıyor
      ctx.rotate(fix.x*0.3); // daha fazla devrilme
      ctx.fillStyle="#0f172a";
      ctx.fillRect(-7,0,15,20);
      ctx.restore();

      ctx.save();
      ctx.translate(fixX+25 + fix.x*20, 310); // sandalye kayıyor
      ctx.rotate(fix.x*0.5); // tamamen devrilebilir
      ctx.beginPath();
      ctx.arc(0,0,5,0,Math.PI*2);
      ctx.fill();
      ctx.restore();

      // Etiketler
      ctx.fillStyle="#cbd5e1";
      ctx.fillText("İzolatörlü (LRB)",100,420);
      ctx.fillText("İzolatörsüz (rijit)",300,420);
    }

    function loop(){
      if(!running) return;
      t+=dt;
      const A=magToAmp(mag);
      const ug=groundMotion(t,A);
      const aIso=step(iso,ug);
      const aFix=step(fix,ug);
      drawScene(ug,aIso,aFix);
      raf=requestAnimationFrame(loop);
    }

    if(running) raf=requestAnimationFrame(loop);
    return ()=>{if(raf) cancelAnimationFrame(raf);}
  },[running,mag,spec]);

  return (
    <div className="wrap">
      <div className="panel">
        <h2>Kontroller</h2>
        <label>Deprem şiddeti (M3–9)</label>
        <input type="range" min="3" max="9" step="0.1" value={mag} onChange={e=>setMag(parseFloat(e.target.value))}/>
        <label>Spektrum</label>
        <select value={spec} onChange={e=>setSpec(e.target.value)}>
          <option value="elazig_short">Elazığ kısa periyot (2.5–5 Hz)</option>
          <option value="elazig_mid">Elazığ orta periyot (1–2 Hz)</option>
          <option value="elazig_broad">Elazığ geniş bant (1–5 Hz)</option>
        </select>
        <div style={{marginTop:"10px"}}>
          <button onClick={()=>setRunning(true)}>Başlat</button>
          <button onClick={()=>setRunning(false)}>Durdur</button>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:"6px",marginTop:"10px"}}>
          <div className="dot blue"></div> <span>İzolatörlü bina (LRB)</span>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:"6px"}}>
          <div className="dot pink"></div> <span>İzolatörsüz bina</span>
        </div>
      </div>
      <div className="panel">
        <h2>Simülasyon</h2>
        <canvas ref={canvasRef} width={600} height={400}></canvas>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("app")).render(<App/>);

</script>
</body>
</html>
